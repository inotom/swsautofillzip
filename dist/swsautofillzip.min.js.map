{"version":3,"sources":["0"],"names":["global","ZIP_RE","addEventListener","elZipField","document","getElementById","elSearchButton","elPrefecture","elCity","elAddress","elHalfAddress","elFullAddress","elMessage","warn","msg","textContent","fillValue","el","value","json","console","error","status","message","results","length","result","setAttribute","match","removeAttribute","e","preventDefault","zipCode","elCallbackScript","body","removeChild","script","createElement","src","id","appendChild","this"],"mappings":";CAWA,SAAUA,GACR,aAEA,IACIC,EAAU,iBAGdD,EAAOE,iBAAiB,mBAAoB,WAG1C,IAAIC,EAAaC,SAASC,eAAe,0BACrCC,EAAiBF,SAASC,eAAe,yBAEzCE,EAAeH,SAASC,eAAe,6BACvCG,EAASJ,SAASC,eAAe,uBACjCI,EAAYL,SAASC,eAAe,0BACpCK,EAAgBN,SAASC,eAAe,+BACxCM,EAAgBP,SAASC,eAAe,+BACxCO,EAAYR,SAASC,eAAe,0BAQpCQ,EAAO,SAASC,GACdF,IACFA,EAAUG,YAAcD,IAWxBE,EAAY,SAASC,EAAIC,GACvBD,IACFA,EAAGC,MAAQA,IAKVlB,EAAoB,yBACvBA,EAAoB,uBAAI,SAASmB,GAE/B,GADAN,EAAK,KACAM,EAGH,OAFAN,EAAK,kBACLO,QAAQC,MAAM,aAGhB,GAAoB,MAAhBF,EAAKG,OAGP,OAFAT,EAAKM,EAAKI,cACVH,QAAQC,MAAMF,EAAKI,SAGrB,GAAKJ,EAAKK,SAAmC,IAAxBL,EAAKK,QAAQC,OAAlC,CAIA,IAAIC,EAASP,EAAKK,QAAQ,GAC1BR,EAAUT,EAAcmB,EAAiB,UACzCV,EAAUR,EAAQkB,EAAiB,UACnCV,EAAUP,EAAWiB,EAAiB,UACtCV,EAAUN,EAAegB,EAAiB,SAAIA,EAAiB,UAC/DV,EAAUL,EAAee,EAAiB,SAAIA,EAAiB,SAAIA,EAAiB,eARlFb,EAAK,4BAYPP,GAAkBH,IAEpBG,EAAeqB,aAAa,WAAY,YAIxCxB,EAAWD,iBAAiB,QAAS,WACrBC,EAAWe,MACbU,MAAM3B,GAChBK,EAAeuB,gBAAgB,YAE/BvB,EAAeqB,aAAa,WAAY,cAEzC,GAEHrB,EAAeJ,iBAAiB,QAAS,SAAS4B,GAChDA,EAAEC,iBACF,IAAIC,EAAU7B,EAAWe,MACzB,GAAIc,EAAQJ,MAAM3B,GAAS,CACzB,IAAIgC,EAAmB7B,SAASC,eAAe,kCAC3C4B,GACF7B,SAAS8B,KAAKC,YAAYF,GAE5B,IAAIG,EAAShC,SAASiC,cAAc,UACpCD,EAAOE,IA7FD,mDA6FiBN,EAAU,mCACjCI,EAAOG,GAAK,iCACZnC,SAAS8B,KAAKM,YAAYJ,MAE3B,MAEJ,IACFK","file":"swsautofillzip.min.js","sourcesContent":["/*! @license swsautofillzip.js v1.0.0 | (c) 2017 http://www.serendip.ws/ | MIT License */ /**********************************************************************************\n  swsautofillzip.js\n\n  file created in 2017/06/17 18:21:08.\n\n  MIT License\n\n  Copyright (c) 2017 iNo (http://www.serendip.ws/)\n\n *********************************************************************************/\n\n(function(global) {\n  'use strict';\n\n  var API_URI = 'http://zipcloud.ibsnet.co.jp/api/search?zipcode=';\n  var ZIP_RE  = /^\\d{3}-?\\d{4}$/;\n  var CALLBACK_NAME = 'swsAutofillzipCallback';\n\n  global.addEventListener('DOMContentLoaded', function() {\n\n    // required elements\n    var elZipField = document.getElementById('swsautofillzip-zipcode');\n    var elSearchButton = document.getElementById('swsautofillzip-search');\n    // optional elements\n    var elPrefecture = document.getElementById('swsautofillzip-prefecture');\n    var elCity = document.getElementById('swsautofillzip-city');\n    var elAddress = document.getElementById('swsautofillzip-address');\n    var elHalfAddress = document.getElementById('swsautofillzip-half-address');\n    var elFullAddress = document.getElementById('swsautofillzip-full-address');\n    var elMessage = document.getElementById('swsautofillzip-message');\n\n    /**\n     * メッセージ表示要素が存在する場合、メッセージを表示する\n     *\n     * @param {string} msg メッセージ文字列.\n     * @returns {undefined}\n     */\n    var warn = function(msg) {\n      if (elMessage) {\n        elMessage.textContent = msg;\n      }\n    };\n\n    /**\n     * 入力要素に値をセットする\n     *\n     * @param {Element|null} el 入力要素.\n     * @param {string} value 入力文字列.\n     * @returns {undefined}\n     */\n    var fillValue = function(el, value) {\n      if (el) {\n        el.value = value;\n      }\n    };\n\n    // JSONP のコールバック関数を定義する\n    if (!global[CALLBACK_NAME]) {\n      global[CALLBACK_NAME] = function(json) {\n        warn('');\n        if (!json) {\n          warn('通信に失敗しました');\n          console.error('通信に失敗しました');\n          return;\n        }\n        if (json.status !== 200) {\n          warn(json.message);\n          console.error(json.message);\n          return;\n        }\n        if (!json.results || json.results.length === 0) {\n          warn('郵便番号検索による住所は見つかりませんでした');\n          return;\n        }\n        var result = json.results[0];\n        fillValue(elPrefecture, result['address1']);\n        fillValue(elCity, result['address2']);\n        fillValue(elAddress, result['address3']);\n        fillValue(elHalfAddress, result['address2'] + result['address3']);\n        fillValue(elFullAddress, result['address1'] + result['address2'] + result['address3']);\n      };\n    }\n\n    if (elSearchButton && elZipField) {\n\n      elSearchButton.setAttribute('disabled', 'disabled');\n\n      // 郵便番号入力値をチェックする\n      // 正しい郵便番号が入力されていた場合、検索ボタンを有効化する\n      elZipField.addEventListener('keyup', function() {\n        var zipCode = elZipField.value;\n        if (zipCode.match(ZIP_RE)) {\n          elSearchButton.removeAttribute('disabled');\n        } else {\n          elSearchButton.setAttribute('disabled', 'disabled');\n        }\n      }, false);\n\n      elSearchButton.addEventListener('click', function(e) {\n        e.preventDefault();\n        var zipCode = elZipField.value;\n        if (zipCode.match(ZIP_RE)) {\n          var elCallbackScript = document.getElementById('swsautofillzip-callback-script');\n          if (elCallbackScript) {\n            document.body.removeChild(elCallbackScript);\n          }\n          var script = document.createElement('script');\n          script.src = API_URI + zipCode + '&callback=' + CALLBACK_NAME;\n          script.id = 'swsautofillzip-callback-script';\n          document.body.appendChild(script);\n        }\n      }, false);\n    }\n  }, false);\n})(this);\n"]}